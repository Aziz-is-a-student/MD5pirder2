<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–®–∞–≥ 7 ‚Äî –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª MD5: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–∞ Y‚ÇÅ | MD5pider</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f8;
      color: #333;
      margin: 0;
      padding: 80px 20px 20px;
      user-select: none;
    }
    .nav-top {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
    }
    .btn {
      padding: 10px 16px;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      text-decoration: none;
      user-select: none;
      min-width: 90px;
      margin-left: 8px;
    }
    .btn:hover:not(:disabled) {
      background: #0d47a1;
    }
    .btn:disabled {
      background: #90a4ae;
      cursor: default;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background: white;
      border-radius: 12px;
      padding: 30px 40px 40px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      user-select: text;
    }
    h2 {
      color: #424242; /* —á—ë—Ä–Ω—ã–π */
      margin-top: 0;
      text-align: center;
    }
    .info-yellow {
      max-width: 850px;
      margin: 20px auto 10px;
      background: #fff9c4;
      border-left: 6px solid #fbc02d;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      color: #5d4037;
      box-shadow: 0 2px 8px rgb(251 192 45 / 0.3);
      user-select: text;
      line-height: 1.4;
    }
    .info-blue {
      max-width: 850px;
      margin: 0 auto 30px;
      background: #e3f2fd;
      border-left: 6px solid #42a5f5;
      padding: 15px 20px;
      border-radius: 8px;
      font-size: 15px;
      color: #0d47a1;
      line-height: 1.5;
      box-shadow: 0 3px 10px rgb(66 165 245 / 0.25);
      user-select: text;
    }
    .registers {
      display: flex;
      justify-content: center;
      gap: 25px;
      margin: 20px 0 35px;
      font-family: monospace;
      font-size: 18px;
      user-select: text;
    }
    .reg-box {
      background: #e3f2fd;
      border: 2px solid #64b5f6;
      padding: 12px 18px;
      border-radius: 8px;
      min-width: 130px;
      text-align: center;
      box-shadow: 0 3px 8px rgba(33,150,243,0.25);
      transition: background-color 0.3s ease;
      position: relative;
    }
    .reg-label {
      font-weight: 700;
      margin-bottom: 8px;
      color: #0d47a1;
      font-size: 20px;
    }
    .reg-value {
      font-family: 'Courier New', Courier, monospace;
      font-size: 20px;
      user-select: text;
      letter-spacing: 1.3px;
    }
    .iteration-info {
      text-align: center;
      margin-bottom: 30px;
      font-size: 18px;
      font-weight: 600;
      color: #424242;
    }
    .iteration-detail {
      max-width: 850px;
      margin: 0 auto 40px;
      background: #e1f5fe;
      border-radius: 10px;
      padding: 18px 30px;
      box-shadow: 0 4px 10px rgba(0, 150, 255, 0.15);
      font-family: monospace;
      font-size: 17px;
      color: #01579b;
      line-height: 1.5;
      user-select: text;
    }
    .iteration-detail span {
      font-weight: 700;
      color: #0277bd;
    }
    .controls {
      text-align: center;
      margin-bottom: 25px;
      user-select: none;
    }
    .speed-select {
      margin-left: 15px;
      font-size: 15px;
      padding: 5px 12px;
      border-radius: 5px;
      border: 1px solid #aaa;
      cursor: pointer;
      user-select: none;
    }
    .progress-bar {
      background: #e0e0e0;
      height: 16px;
      width: 100%;
      border-radius: 10px;
      overflow: hidden;
      max-width: 850px;
      margin: 0 auto 40px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.12);
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      background: #42a5f5;
      transition: width 0.3s ease;
    }
    .footer-note {
      max-width: 850px;
      margin: 0 auto;
      font-size: 14px;
      color: #555;
      text-align: center;
      user-select: none;
    }
  </style>
</head>
<body>

<div class="nav-top">
  <a id="step6link" class="btn" href="#">‚¨Ö –®–∞–≥ 6</a>
  <a href="index.html" class="btn">üè† –ì–ª–∞–≤–Ω–∞—è</a>
  <button id="step8btn" class="btn" disabled style="opacity:0.5; pointer-events:none;">–®–∞–≥ 8 ‚û°</button>
</div>

<div class="container">

  <h2>üõ† –®–∞–≥ 7 ‚Äî –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª MD5: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–∞ Y‚ÇÅ</h2>

  <div class="info-yellow">
    –ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: '<span id="originalText">crypto</span>'<br />
    –î–ª–∏–Ω–∞ –±–ª–æ–∫–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 512 –±–∏—Ç<br />
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–π –±–ª–æ–∫: Y‚ÇÅ
  </div>

  <div class="info-blue">
    <strong>–¢–µ–æ—Ä–∏—è: —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —ç—Ç–æ–º —à–∞–≥–µ?</strong><br />
    –ù–∞ —ç—Ç–æ–º —à–∞–≥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ç–æ—Ä–æ–≥–æ –±–ª–æ–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ CV1 –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞.<br />
    MD5 –≤—ã–ø–æ–ª–Ω—è–µ—Ç 64 –∏—Ç–µ—Ä–∞—Ü–∏–∏ –≤ 4 —Ä–∞—É–Ω–¥–∞—Ö —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ F, G, H –∏ I –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Å–¥–≤–∏–≥–∞–º–∏.<br />
    –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Å—Ç–∞–Ω–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ CV2, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö.
  </div>

  <div class="registers" aria-label="–ó–Ω–∞—á–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ MD5">
    <div class="reg-box" id="regA"><div class="reg-label">A</div><div class="reg-value">0x00000000</div></div>
    <div class="reg-box" id="regB"><div class="reg-label">B</div><div class="reg-value">0x00000000</div></div>
    <div class="reg-box" id="regC"><div class="reg-label">C</div><div class="reg-value">0x00000000</div></div>
    <div class="reg-box" id="regD"><div class="reg-label">D</div><div class="reg-value">0x00000000</div></div>
  </div>

  <div class="iteration-info" id="iterationInfo">
    –ò—Ç–µ—Ä–∞—Ü–∏—è: <span id="iterNumber">0</span> / 64
    &nbsp;&nbsp;|&nbsp;&nbsp;
    –†–∞—É–Ω–¥: <span id="roundName">-</span>
  </div>

  <div class="iteration-detail" id="iterationDetail" aria-live="polite" aria-atomic="true">
    –ù–∞–∂–º–∏—Ç–µ "–í–ø–µ—Ä—ë–¥", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –±–ª–æ–∫–∞.
  </div>

  <div class="controls" role="region" aria-label="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–≥–∞–º–∏ –∞–Ω–∏–º–∞—Ü–∏–∏">
    <button class="btn" id="prevBtn" disabled>‚¨Ö –ù–∞–∑–∞–¥</button>
    <button class="btn" id="nextBtn">–í–ø–µ—Ä—ë–¥ ‚û°</button>
    <button class="btn" id="autoBtn">‚ñ∂ –ê–≤—Ç–æ</button>
    <button class="btn" id="resetBtn" style="background:#d32f2f;">‚ü≤ –°–±—Ä–æ—Å</button>

    <label for="speedSelect" style="margin-left: 15px; font-weight: 600; color:#1976d2;">–°–∫–æ—Ä–æ—Å—Ç—å:</label>
    <select id="speedSelect" class="speed-select" aria-label="–í—ã–±–æ—Ä —Å–∫–æ—Ä–æ—Å—Ç–∏ –∞–Ω–∏–º–∞—Ü–∏–∏">
      <option value="slow">–ú–µ–¥–ª–µ–Ω–Ω–æ</option>
      <option value="medium" selected>–°—Ä–µ–¥–Ω–µ</option>
      <option value="fast">–ë—ã—Å—Ç—Ä–æ</option>
      <option value="instant">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ</option>
    </select>
  </div>

  <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="64" aria-valuenow="0" aria-label="–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–ª–æ–∫–∞">
    <div class="progress-fill" id="progressFill"></div>
  </div>

  <div class="footer-note">
    –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ç–æ—Ä–æ–≥–æ –±–ª–æ–∫–∞ —Å —É—á—ë—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è CV1 –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞.
  </div>
</div>

<script>
    const params = new URLSearchParams(window.location.search);
    const text = params.get("text") || "crypto";
    const allData = sessionStorage.getItem("step5data") || "";
  
    // CV –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–µ—Å–ª–∏ —à–∞–≥ 6 –Ω–µ –ø–µ—Ä–µ–¥–∞–ª –Ω–æ–≤—ã–µ)
    const INIT_A = parseInt(params.get("cvA")) || 0x67452301;
    const INIT_B = parseInt(params.get("cvB")) || 0xefcdab89;
    const INIT_C = parseInt(params.get("cvC")) || 0x98badcfe;
    const INIT_D = parseInt(params.get("cvD")) || 0x10325476;
  
    // –ï—Å–ª–∏ –Ω–µ—Ç –≤—Ç–æ—Ä–æ–≥–æ –±–ª–æ–∫–∞ ‚Äî —Å—Ä–∞–∑—É –Ω–∞ —à–∞–≥ 8
    if (allData.length < 1024) {
      const url = `step8.html?text=${encodeURIComponent(text)}&data=${encodeURIComponent(allData)}&cvA=${INIT_A}&cvB=${INIT_B}&cvC=${INIT_C}&cvD=${INIT_D}`;
      window.location.href = url;
    }
  
    // –ë–µ—Ä—ë–º –±–ª–æ–∫ Y‚ÇÅ (–≤—Ç–æ—Ä–æ–π 512-–±–∏—Ç–Ω—ã–π)
    const data = allData.slice(512, 1024).padEnd(512, '0');
  
    document.getElementById('originalText').textContent = text;
  

  const K = [
    0xd76aa478,0xe8c7b756,0x242070db,0xc1bdceee,
    0xf57c0faf,0x4787c62a,0xa8304613,0xfd469501,
    0x698098d8,0x8b44f7af,0xffff5bb1,0x895cd7be,
    0x6b901122,0xfd987193,0xa679438e,0x49b40821,
    0xf61e2562,0xc040b340,0x265e5a51,0xe9b6c7aa,
    0xd62f105d,0x02441453,0xd8a1e681,0xe7d3fbc8,
    0x21e1cde6,0xc33707d6,0xf4d50d87,0x455a14ed,
    0xa9e3e905,0xfcefa3f8,0x676f02d9,0x8d2a4c8a,
    0xfffa3942,0x8771f681,0x6d9d6122,0xfde5380c,
    0xa4beea44,0x4bdecfa9,0xf6bb4b60,0xbebfbc70,
    0x289b7ec6,0xeaa127fa,0xd4ef3085,0x04881d05,
    0xd9d4d039,0xe6db99e5,0x1fa27cf8,0xc4ac5665,
    0xf4292244,0x432aff97,0xab9423a7,0xfc93a039,
    0x655b59c3,0x8f0ccc92,0xffeff47d,0x85845dd1,
    0x6fa87e4f,0xfe2ce6e0,0xa3014314,0x4e0811a1,
    0xf7537e82,0xbd3af235,0x2ad7d2bb,0xeb86d391
  ];
  const S = [
    7,12,17,22, 7,12,17,22, 7,12,17,22, 7,12,17,22,
    5, 9,14,20, 5, 9,14,20, 5, 9,14,20, 5, 9,14,20,
    4,11,16,23, 4,11,16,23, 4,11,16,23, 4,11,16,23,
    6,10,15,21, 6,10,15,21, 6,10,15,21, 6,10,15,21
  ];

  // –ü–∞—Ä—Å–∏–º –±–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö –≤ 16 —Å–ª–æ–≤ (little-endian)
  const M = [];
  for (let i = 0; i < 512; i += 32) {
    const chunk = data.slice(i, i + 32);
    if (chunk.length !== 32) {
      console.error('–û—à–∏–±–∫–∞ –¥–ª–∏–Ω—ã —Å–ª–æ–≤–∞ (–æ–∂–∏–¥–∞–ª–æ—Å—å 32):', chunk.length);
      break;
    }
    const bytes = chunk.match(/.{8}/g);
    if (!bytes || bytes.length !== 4) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–±–∏–µ–Ω–∏–∏ –Ω–∞ –±–∞–π—Ç—ã:', chunk);
      break;
    }
    const reversed = bytes.reverse().join('');
    const val = parseInt(reversed, 2);
    if (isNaN(val)) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ —á–∏—Å–ª–æ:', reversed);
      break;
    }
    M.push(val);
  }
  
  let A = INIT_A;
  let B = INIT_B;
  let C = INIT_C;
  let D = INIT_D;

  const regValuesElems = {
    A: document.querySelector('#regA .reg-value'),
    B: document.querySelector('#regB .reg-value'),
    C: document.querySelector('#regC .reg-value'),
    D: document.querySelector('#regD .reg-value'),
  };

  const iterNumberElem = document.getElementById('iterNumber');
  const roundNameElem = document.getElementById('roundName');
  const iterationDetailElem = document.getElementById('iterationDetail');
  const progressFill = document.getElementById('progressFill');
  const step8btn = document.getElementById('step8btn');

  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const autoBtn = document.getElementById('autoBtn');
  const resetBtn = document.getElementById('resetBtn');
  const speedSelect = document.getElementById('speedSelect');

  let currentStep = 0;
  let autoPlayId = null;

  function updateRegisters() {
    regValuesElems.A.textContent = "0x" + toHex(A);
    regValuesElems.B.textContent = "0x" + toHex(B);
    regValuesElems.C.textContent = "0x" + toHex(C);
    regValuesElems.D.textContent = "0x" + toHex(D);
  }

  function toHex(num) {
    return (num >>> 0).toString(16).padStart(8, '0');
  }

  function getRound(i) {
    if (i < 16) return 'F';
    if (i < 32) return 'G';
    if (i < 48) return 'H';
    return 'I';
  }

  function gIndex(i) {
    if (i < 16) return i;
    if (i < 32) return (5 * i + 1) % 16;
    if (i < 48) return (3 * i + 5) % 16;
    return (7 * i) % 16;
  }

  function F(x,y,z) { return (x & y) | (~x & z); }
  function G(x,y,z) { return (x & z) | (y & ~z); }
  function H(x,y,z) { return x ^ y ^ z; }
  function I(x,y,z) { return y ^ (x | ~z); }

  function Ffunc(round, b, c, d) {
    switch(round) {
      case 'F': return F(b,c,d);
      case 'G': return G(b,c,d);
      case 'H': return H(b,c,d);
      case 'I': return I(b,c,d);
    }
  }

  function leftRotate(x, c) {
    return (x << c) | (x >>> (32 - c));
  }

  const history = [];

  function md5Step(i, A_in, B_in, C_in, D_in) {
    const round = getRound(i);
    const g = gIndex(i);
    const Fval = Ffunc(round, B_in, C_in, D_in);
    const s = S[i];
    const Kval = K[i];
    const sum = (A_in + Fval + M[g] + Kval) >>> 0;
    const rotated = leftRotate(sum, s) >>> 0;
    const B_new = (B_in + rotated) >>> 0;
    return {
      A: D_in,
      B: B_new,
      C: B_in,
      D: C_in,
      round, g, Fval, Kval, s,
      sum, rotated,
    };
  }

  function renderIterationInfo(i, state) {
    iterNumberElem.textContent = i + 1;
    roundNameElem.textContent = state.round;
    roundNameElem.style.color = '#424242';
    function hex32(num) { return "0x" + toHex(num); }
    iterationDetailElem.innerHTML = `
      <p>–§—É–Ω–∫—Ü–∏—è <span style="color:#0d47a1; font-weight:700;">${state.round}</span> —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏:</p>
      <p>&nbsp;&nbsp;B = <span>${hex32(B)}</span>, C = <span>${hex32(C)}</span>, D = <span>${hex32(D)}</span></p>
      <p>–†–∞—Å—Å—á—ë—Ç: <code>F(B,C,D) = ${hex32(state.Fval)}</code></p>
      <p>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–æ–≤–æ M[${state.g}]: <code>${hex32(M[state.g])}</code></p>
      <p>–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ K[${i}]: <code>${hex32(state.Kval)}</code></p>
      <p>–°–¥–≤–∏–≥ –≤–ª–µ–≤–æ –Ω–∞ s[${i}] = ${state.s} –±–∏—Ç</p>
      <hr>
      <p>–í—ã—á–∏—Å–ª—è–µ–º —Å—É–º–º—É: <code>(A + F + M[g] + K[i]) = ${hex32(state.sum)}</code></p>
      <p>–ü–æ—Å–ª–µ —Å–¥–≤–∏–≥–∞ –≤–ª–µ–≤–æ: <code>${hex32(state.rotated)}</code></p>
      <p>–û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–≥–∏—Å—Ç—Ä B: <code>B = B + —Å–¥–≤–∏–Ω—É—Ç–∞—è —Å—É–º–º–∞ = ${hex32(state.B)}</code></p>
      <p>–ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤:</p>
      <p>&nbsp;&nbsp;A ‚Üê D = ${hex32(state.A)}</p>
      <p>&nbsp;&nbsp;D ‚Üê C = ${hex32(state.D)}</p>
      <p>&nbsp;&nbsp;C ‚Üê B (—Å—Ç–∞—Ä–æ–µ) = ${hex32(state.C)}</p>
      <p>&nbsp;&nbsp;B ‚Üê –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ = ${hex32(state.B)}</p>
    `;
  }

  function nextStep() {
    if (currentStep >= 64) return;
    history.push({A, B, C, D});
    const res = md5Step(currentStep, A, B, C, D);
    A = res.A;
    B = res.B;
    C = res.C;
    D = res.D;
    updateRegisters();
    renderIterationInfo(currentStep, res);
    currentStep++;
    updateProgress();
    prevBtn.disabled = false;
    if (currentStep === 64) {
      nextBtn.disabled = true;
      autoBtn.disabled = true;
      step8btn.disabled = false;
      step8btn.style.opacity = 1;
      step8btn.style.pointerEvents = "auto";
      iterationDetailElem.innerHTML += `<p style="margin-top:20px; font-weight:bold; color:#2e7d32;">
      ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –≤—Ç–æ—Ä–æ–≥–æ –±–ª–æ–∫–∞ –∑–∞–≤–µ—Ä—à—ë–Ω!<br>
      –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±—É—Ñ–µ—Ä–∞ (CV2):<br>
      A = 0x${toHex((INIT_A + A) >>> 0)}<br>
      B = 0x${toHex((INIT_B + B) >>> 0)}<br>
      C = 0x${toHex((INIT_C + C) >>> 0)}<br>
      D = 0x${toHex((INIT_D + D) >>> 0)}<br>
      –ù–∞–∂–º–∏—Ç–µ "–®–∞–≥ 8" –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç—Ç–∞–ø–∞.
      </p>`;
    }
    if (currentStep === 1) prevBtn.disabled = false;
  }  function prevStep() {
    if (currentStep <= 0) return;
    currentStep--;
    const prevState = history.pop();
    if (prevState) {
      A = prevState.A;
      B = prevState.B;
      C = prevState.C;
      D = prevState.D;
    }
    updateRegisters();
    updateRegistersHighlight();
    iterationDetailElem.textContent = '–®–∞–≥ –Ω–∞–∑–∞–¥. –ò—Ç–µ—Ä–∞—Ü–∏—è: ' + (currentStep) + '. –ù–∞–∂–º–∏—Ç–µ "–í–ø–µ—Ä—ë–¥" —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.';
    updateProgress();
    nextBtn.disabled = false;
    autoBtn.disabled = false;
    if (currentStep === 0) prevBtn.disabled = true;
    step8btn.disabled = true;
    step8btn.style.opacity = 0.5;
    step8btn.style.pointerEvents = "none";
  }

  function updateProgress() {
    progressFill.style.width = (currentStep / 64) * 100 + '%';
    progressFill.parentElement.setAttribute('aria-valuenow', currentStep);
  }

  function autoPlay() {
    if (autoPlayId) {
      clearInterval(autoPlayId);
      autoPlayId = null;
      autoBtn.textContent = '‚ñ∂ –ê–≤—Ç–æ';
      nextBtn.disabled = false;
      prevBtn.disabled = currentStep === 0;
      return;
    }
    autoBtn.textContent = '‚è∏ –°—Ç–æ–ø';
    nextBtn.disabled = true;
    prevBtn.disabled = true;
    const speeds = { slow: 800, medium: 400, fast: 120, instant: 0 };
    const delay = speeds[speedSelect.value] ?? 400;
    if (delay === 0) {
      while (currentStep < 64) nextStep();
      autoPlay();
      return;
    }
    autoPlayId = setInterval(() => {
      if (currentStep >= 64) {
        autoPlay();
        return;
      }
      nextStep();
    }, delay);
  }

  function reset() {
    if (autoPlayId) {
      clearInterval(autoPlayId);
      autoPlayId = null;
      autoBtn.textContent = '‚ñ∂ –ê–≤—Ç–æ';
    }
    currentStep = 0;
    history.length = 0;
    A = INIT_A;
    B = INIT_B;
    C = INIT_C;
    D = INIT_D;
    updateRegisters();
    updateRegistersHighlight();
    iterationDetailElem.textContent = '–ù–∞–∂–º–∏—Ç–µ "–í–ø–µ—Ä—ë–¥", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –±–ª–æ–∫–∞.';
    prevBtn.disabled = true;
    nextBtn.disabled = false;
    autoBtn.disabled = false;
    step8btn.disabled = true;
    step8btn.style.opacity = 0.5;
    step8btn.style.pointerEvents = "none";
    updateProgress();
  }

  step8btn.onclick = () => {
    const url = `step8.html?text=${encodeURIComponent(text)}&data=${encodeURIComponent(data)}&cvA=${(INIT_A + A) >>> 0}&cvB=${(INIT_B + B) >>> 0}&cvC=${(INIT_C + C) >>> 0}&cvD=${(INIT_D + D) >>> 0}`;
  window.location.href = url;
  };

  document.getElementById('step6link').href = `step6.html?text=${encodeURIComponent(text)}`;


  nextBtn.onclick = nextStep;
  prevBtn.onclick = prevStep;
  autoBtn.onclick = autoPlay;
  resetBtn.onclick = reset;
  speedSelect.onchange = () => { if (autoPlayId) autoPlay(); };

  reset();
</script>

</body>
</html>
