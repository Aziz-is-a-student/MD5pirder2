<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–®–∞–≥ 6 ‚Äî –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª MD5 (HxMD5(Y‚ÇÄ)) | MD5pider</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f8;
      color: #333;
      margin: 0; padding: 80px 20px 20px;
      user-select: none;
    }
    .info-yellow {
    max-width: 850px;
    margin: 20px auto 10px;
    background: #fff9c4;
    border-left: 6px solid #fbc02d;
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 600;
    color: #5d4037;
    box-shadow: 0 2px 8px rgb(251 192 45 / 0.3);
    user-select: text;
    line-height: 1.4;
    }

    .info-blue {
      max-width: 850px;
      margin: 0 auto 30px;
      background: #e3f2fd;
      border-left: 6px solid #42a5f5;
      padding: 15px 20px;
      border-radius: 8px;
      font-size: 15px;
      color: #0d47a1;
      line-height: 1.5;
      box-shadow: 0 3px 10px rgb(66 165 245 / 0.25);
      user-select: text;
    }
    .nav-top {
      position: fixed; top: 0; left: 0; right: 0;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 10px 20px;
      display: flex; justify-content: space-between; align-items: center;
      z-index: 1000;
    }
    .btn {
      padding: 10px 16px;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      text-decoration: none;
      user-select: none;
      min-width: 90px;
      margin-left: 8px;
    }
    .btn:hover:not(:disabled) {
      background: #0d47a1;
    }
    .btn:disabled {
      background: #90a4ae;
      cursor: default;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background: white;
      border-radius: 12px;
      padding: 30px 40px 40px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      user-select: text;
    }
    h2 {
      color: #1976d2;
      margin-top: 0;
      text-align: center;
    }
    .registers {
      display: flex;
      justify-content: center;
      gap: 25px;
      margin: 20px 0 35px;
      font-family: monospace;
      font-size: 18px;
      user-select: text;
    }
    .reg-box {
      background: #e3f2fd;
      border: 2px solid #64b5f6;
      padding: 12px 18px;
      border-radius: 8px;
      min-width: 130px;
      text-align: center;
      box-shadow: 0 3px 8px rgba(33,150,243,0.25);
      transition: background-color 0.3s ease;
      position: relative;
    }
    .reg-box.highlight {
      background-color: #90caf9;
      box-shadow: 0 6px 14px rgba(33,150,243,0.6);
    }
    .reg-label {
      font-weight: 700;
      margin-bottom: 8px;
      color: #0d47a1;
      font-size: 20px;
    }
    .reg-value {
      font-family: 'Courier New', Courier, monospace;
      font-size: 20px;
      user-select: text;
      letter-spacing: 1.3px;
    }

    .iteration-info {
      text-align: center;
      margin-bottom: 30px;
      font-size: 18px;
      font-weight: 600;
      color: #424242;
    }

    .iteration-detail {
      max-width: 850px;
      margin: 0 auto 40px;
      background: #e1f5fe;
      border-radius: 10px;
      padding: 18px 30px;
      box-shadow: 0 4px 10px rgba(0, 150, 255, 0.15);
      font-family: monospace;
      font-size: 17px;
      color: #01579b;
      line-height: 1.5;
      user-select: text;
    }

    .iteration-detail span {
      font-weight: 700;
      color: #0277bd;
    }

    .controls {
      text-align: center;
      margin-bottom: 25px;
      user-select: none;
    }
    .speed-select {
      margin-left: 15px;
      font-size: 15px;
      padding: 5px 12px;
      border-radius: 5px;
      border: 1px solid #aaa;
      cursor: pointer;
      user-select: none;
    }
    .progress-bar {
      background: #e0e0e0;
      height: 16px;
      width: 100%;
      border-radius: 10px;
      overflow: hidden;
      max-width: 850px;
      margin: 0 auto 40px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.12);
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      background: #42a5f5;
      transition: width 0.3s ease;
    }

    .footer-note {
      max-width: 850px;
      margin: 0 auto;
      font-size: 14px;
      color: #555;
      text-align: center;
      user-select: none;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–ª–∞–≤–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è */
    @keyframes fadeInHighlight {
      0% { background-color: #90caf9; }
      100% { background-color: #e3f2fd; }
    }
    .flash {
      animation: fadeInHighlight 1.5s ease forwards;
    }
  </style>
</head>
<body>

<div class="nav-top">
  <a href="step5.html" class="btn">‚¨Ö –®–∞–≥ 5</a>
  <a href="index.html" class="btn">üè† –ì–ª–∞–≤–Ω–∞—è</a>
  <a id="step7btn" class="btn" style="opacity:0.5; pointer-events:none;">–®–∞–≥ 7 ‚û°</a>
</div>

<div class="container">
  <h2>üõ† –®–∞–≥ 6 ‚Äî –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª MD5: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–∞ Y‚ÇÄ</h2>

  <div class="info-yellow">
    –ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: '<span id="originalText">—År—É—Äto</span>'<br />
    –î–ª–∏–Ω–∞ –±–ª–æ–∫–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 512 –±–∏—Ç<br />
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–π –±–ª–æ–∫: Y<sub>0</sub> (–ø–µ—Ä–≤—ã–π)
  </div>

  <div class="info-blue">
    <strong>–¢–µ–æ—Ä–∏—è: —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —ç—Ç–æ–º —à–∞–≥–µ?</strong><br />
    –ù–∞ —ç—Ç–æ–º —à–∞–≥–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–≤–æ–≥–æ –±–ª–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö Y<sub>0</sub>.<br />
    –ê–ª–≥–æ—Ä–∏—Ç–º MD5 –≤—ã–ø–æ–ª–Ω—è–µ—Ç 64 –∏—Ç–µ—Ä–∞—Ü–∏–∏ (4 —Ä–∞—É–Ω–¥–∞ –ø–æ 16 –æ–ø–µ—Ä–∞—Ü–∏–π), –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ A, B, C –∏ D.<br />
    –ö–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–¥–Ω—É –∏–∑ –Ω–µ–ª–∏–Ω–µ–π–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π F, G, H –∏–ª–∏ I, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É K[i] –∏ —Å–¥–≤–∏–≥ S[i].
  </div>

  <div class="registers" aria-label="–ó–Ω–∞—á–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ MD5">
    <div class="reg-box" id="regA"><div class="reg-label">A</div><div class="reg-value">0x67452301</div></div>
    <div class="reg-box" id="regB"><div class="reg-label">B</div><div class="reg-value">0xefcdab89</div></div>
    <div class="reg-box" id="regC"><div class="reg-label">C</div><div class="reg-value">0x98badcfe</div></div>
    <div class="reg-box" id="regD"><div class="reg-label">D</div><div class="reg-value">0x10325476</div></div>
  </div>

  <div class="iteration-info" id="iterationInfo">
    –ò—Ç–µ—Ä–∞—Ü–∏—è: <span id="iterNumber">0</span> / 64
    &nbsp;&nbsp;|&nbsp;&nbsp;
    –†–∞—É–Ω–¥: <span id="roundName">-</span>
  </div>

  <div class="iteration-detail" id="iterationDetail" aria-live="polite" aria-atomic="true">
    –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏...
  </div>

  <div class="controls" role="region" aria-label="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–≥–∞–º–∏ –∞–Ω–∏–º–∞—Ü–∏–∏">
    <button class="btn" id="prevBtn" disabled>‚¨Ö –ù–∞–∑–∞–¥</button>
    <button class="btn" id="nextBtn">–í–ø–µ—Ä—ë–¥ ‚û°</button>
    <button class="btn" id="autoBtn">‚ñ∂ –ê–≤—Ç–æ</button>
    <button class="btn" id="resetBtn" style="background:#d32f2f;">‚ü≤ –°–±—Ä–æ—Å</button>

    <label for="speedSelect" style="margin-left: 15px; font-weight: 600; color:#1976d2;">–°–∫–æ—Ä–æ—Å—Ç—å:</label>
    <select id="speedSelect" class="speed-select" aria-label="–í—ã–±–æ—Ä —Å–∫–æ—Ä–æ—Å—Ç–∏ –∞–Ω–∏–º–∞—Ü–∏–∏">
      <option value="slow">–ú–µ–¥–ª–µ–Ω–Ω–æ</option>
      <option value="medium" selected>–°—Ä–µ–¥–Ω–µ</option>
      <option value="fast">–ë—ã—Å—Ç—Ä–æ</option>
      <option value="instant">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ</option>
    </select>
  </div>

  <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="64" aria-valuenow="0" aria-label="–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–ª–æ–∫–∞">
    <div class="progress-fill" id="progressFill"></div>
  </div>

  <div class="footer-note">
    –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –∞–ª–≥–æ—Ä–∏—Ç–º MD5 —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4 —Ä–∞—É–Ω–¥–æ–≤ –ø–æ 16 –∏—Ç–µ—Ä–∞—Ü–∏–π. –ó–¥–µ—Å—å –º—ã –ø–æ–¥—Ä–æ–±–Ω–æ —Å–º–æ—Ç—Ä–∏–º –∫–∞–∂–¥—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–ª–æ–∫–∞ Y‚ÇÄ.
  </div>
</div>

<script>
  // –ü–∞—Ä—Å–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
  const params = new URLSearchParams(window.location.search);
  const text = params.get("text") || "crypto";
  const data = (params.get("data") || "").padEnd(512, '0'); // 512 –±–∏—Ç

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ A,B,C,D —Å–æ–≥–ª–∞—Å–Ω–æ RFC 1321
  const INIT_A = 0x67452301;
  const INIT_B = 0xefcdab89;
  const INIT_C = 0x98badcfe;
  const INIT_D = 0x10325476;

  // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã K[i] ‚Äî –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –¥–ª—è MD5 (64 —à—Ç—É–∫–∏)
  const K = [
    0xd76aa478,0xe8c7b756,0x242070db,0xc1bdceee,
    0xf57c0faf,0x4787c62a,0xa8304613,0xfd469501,
    0x698098d8,0x8b44f7af,0xffff5bb1,0x895cd7be,
    0x6b901122,0xfd987193,0xa679438e,0x49b40821,
    0xf61e2562,0xc040b340,0x265e5a51,0xe9b6c7aa,
    0xd62f105d,0x02441453,0xd8a1e681,0xe7d3fbc8,
    0x21e1cde6,0xc33707d6,0xf4d50d87,0x455a14ed,
    0xa9e3e905,0xfcefa3f8,0x676f02d9,0x8d2a4c8a,
    0xfffa3942,0x8771f681,0x6d9d6122,0xfde5380c,
    0xa4beea44,0x4bdecfa9,0xf6bb4b60,0xbebfbc70,
    0x289b7ec6,0xeaa127fa,0xd4ef3085,0x04881d05,
    0xd9d4d039,0xe6db99e5,0x1fa27cf8,0xc4ac5665,
    0xf4292244,0x432aff97,0xab9423a7,0xfc93a039,
    0x655b59c3,0x8f0ccc92,0xffeff47d,0x85845dd1,
    0x6fa87e4f,0xfe2ce6e0,0xa3014314,0x4e0811a1,
    0xf7537e82,0xbd3af235,0x2ad7d2bb,0xeb86d391
  ];

  // –°–¥–≤–∏–≥–∏ s[i]
  const S = [
    7,12,17,22, 7,12,17,22, 7,12,17,22, 7,12,17,22,
    5, 9,14,20, 5, 9,14,20, 5, 9,14,20, 5, 9,14,20,
    4,11,16,23, 4,11,16,23, 4,11,16,23, 4,11,16,23,
    6,10,15,21, 6,10,15,21, 6,10,15,21, 6,10,15,21
  ];

  // –§—É–Ω–∫—Ü–∏–∏ F, G, H, I
  function F(x,y,z) { return (x & y) | (~x & z); }
  function G(x,y,z) { return (x & z) | (y & ~z); }
  function H(x,y,z) { return x ^ y ^ z; }
  function I(x,y,z) { return y ^ (x | ~z); }

  // –õ–µ–≤—ã–π —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π —Å–¥–≤–∏–≥ 32 –±–∏—Ç
  function leftRotate(x, c) {
    return (x << c) | (x >>> (32 - c));
  }

  // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ 32-–±–∏—Ç–Ω–æ–≥–æ unsigned int –≤ hex —Å—Ç—Ä–æ–∫—É 8 —Å–∏–º–≤–æ–ª–æ–≤
  function toHex(num) {
    return (num >>> 0).toString(16).padStart(8, '0');
  }

  // –†–∞–∑–±–∏–≤–∞–µ–º data –Ω–∞ 16 —Å–ª–æ–≤ –ø–æ 32 –±–∏—Ç–∞ little-endian
  // data - —Å—Ç—Ä–æ–∫–∞ –∏–∑ 512 —Å–∏–º–≤–æ–ª–æ–≤ '0' –∏–ª–∏ '1'
  const M = [];
  for (let i = 0; i < 512; i += 32) {
    // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –±–∞–π—Ç—ã
    const bytes = data.slice(i, i + 32).match(/.{8}/g);
    const littleEndian = bytes.reverse().join('');
    M.push(parseInt(littleEndian, 2));
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–≥–∏—Å—Ç—Ä—ã
  let A = INIT_A, B = INIT_B, C = INIT_C, D = INIT_D;

  // –î–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  const regElems = {
    A: document.getElementById('regA'),
    B: document.getElementById('regB'),
    C: document.getElementById('regC'),
    D: document.getElementById('regD'),
  };

  const regValuesElems = {
    A: regElems.A.querySelector('.reg-value'),
    B: regElems.B.querySelector('.reg-value'),
    C: regElems.C.querySelector('.reg-value'),
    D: regElems.D.querySelector('.reg-value'),
  };

  // –≠–ª–µ–º–µ–Ω—Ç—ã UI
  const iterNumberElem = document.getElementById('iterNumber');
  const roundNameElem = document.getElementById('roundName');
  const iterationDetailElem = document.getElementById('iterationDetail');
  const progressFill = document.getElementById('progressFill');
  const step7btn = document.getElementById('step7btn');

  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const autoBtn = document.getElementById('autoBtn');
  const resetBtn = document.getElementById('resetBtn');
  const speedSelect = document.getElementById('speedSelect');

  // –ò—Ç–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—É—â–∞—è
  let currentStep = 0; // –æ—Ç 0 –¥–æ 64
  let autoPlayId = null;

  // –†–∞—Å—á—ë—Ç g(i) –∏ F_i –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ (i=0..63)
  function getRound(i) {
    if (i >= 0 && i < 16) return 'F';
    if (i >= 16 && i < 32) return 'G';
    if (i >= 32 && i < 48) return 'H';
    if (i >= 48 && i < 64) return 'I';
    return '-';
  }

  function gIndex(i) {
    if (i >= 0 && i < 16) return i;
    if (i >= 16 && i < 32) return (5 * i + 1) % 16;
    if (i >= 32 && i < 48) return (3 * i + 5) % 16;
    if (i >= 48 && i < 64) return (7 * i) % 16;
  }

  function Ffunc(round, b, c, d) {
    switch(round) {
      case 'F': return F(b,c,d);
      case 'G': return G(b,c,d);
      case 'H': return H(b,c,d);
      case 'I': return I(b,c,d);
    }
  }

  // –°–æ—Ö—Ä–∞–Ω–∏–º –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞–∑–∞–¥
  const history = [];

  // –û–±–Ω–æ–≤–ª—è–µ–º UI —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤
  function updateRegistersHighlight(highlightReg) {
    for (const reg in regElems) {
      regElems[reg].classList.remove('highlight', 'flash');
    }
    if (highlightReg && regElems[highlightReg]) {
      regElems[highlightReg].classList.add('highlight');
      // –ß—Ç–æ–±—ã –±—ã–ª–∞ –∞–Ω–∏–º–∞—Ü–∏—è –≤—Å–ø—ã—à–∫–∏
      setTimeout(() => regElems[highlightReg].classList.add('flash'), 50);
      setTimeout(() => regElems[highlightReg].classList.remove('flash'), 1500);
    }
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  function updateRegisters() {
    regValuesElems.A.textContent = "0x" + toHex(A);
    regValuesElems.B.textContent = "0x" + toHex(B);
    regValuesElems.C.textContent = "0x" + toHex(C);
    regValuesElems.D.textContent = "0x" + toHex(D);
  }

  // –í—ã–ø–æ–ª–Ω—è–µ–º –æ–¥–∏–Ω —à–∞–≥ i –∏—Ç–µ—Ä–∞—Ü–∏–∏ (–≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –ø–æ—Å–ª–µ —à–∞–≥–∞)
  function md5Step(i, A_in, B_in, C_in, D_in) {
    const round = getRound(i);
    const g = gIndex(i);
    const Fval = Ffunc(round, B_in, C_in, D_in);

    const s = S[i];
    const Kval = K[i];

    // –§–æ—Ä–º—É–ª–∞
    // temp = D
    // D = C
    // C = B
    // B = B + leftRotate((A + F + M[g] + K[i]), s)
    // A = temp

    const sum = (A_in + Fval + M[g] + Kval) >>> 0;
    const rotated = leftRotate(sum, s) >>> 0;
    const B_new = (B_in + rotated) >>> 0;

    return {
      A: D_in,
      B: B_new,
      C: B_in,
      D: C_in,
      round, g, Fval, Kval, s,
      sum, rotated,
    };
  }

  // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –∏—Ç–µ—Ä–∞—Ü–∏–∏
 function renderIterationInfo(i, state) {
  iterNumberElem.textContent = i + 1;
  roundNameElem.textContent = state.round;

  const hex32 = num => "0x" + toHex(num);
  const bitStart = state.g * 32;
  const rawBits = data.slice(bitStart, bitStart + 32);
  const leBytes = rawBits.match(/.{8}/g).reverse().join(' '); // little-endian –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ

  iterationDetailElem.innerHTML = `
    <p>–†–∞—É–Ω–¥: <strong style="color:#0d47a1;">${state.round}</strong> &nbsp;&nbsp;
       g = <strong>${state.g}</strong> &nbsp;&nbsp;
       s = <strong>${state.s}</strong> –±–∏—Ç</p>

    <hr>

    <p><strong>–°–ª–æ–≤–æ M[${state.g}]</strong> –∏–∑ –±–ª–æ–∫–∞ Y‚ÇÄ:</p>
    <p>–ò—Å—Ö–æ–¥–Ω—ã–µ –±–∏—Ç—ã: <code>${rawBits}</code><br />
       –†–∞–∑–≤—ë—Ä–Ω—É—Ç–æ (little-endian): <code>${leBytes}</code><br />
       –ó–Ω–∞—á–µ–Ω–∏–µ: <code>${hex32(M[state.g])}</code></p>

    <p><strong>–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ K[${i}]</strong>: <code>${hex32(state.Kval)}</code><br />
       –§–æ—Ä–º—É–ª–∞: <code>K[${i}] = floor(2^32 √ó |sin(${i + 1})|)</code></p>

    <hr>

    <p><strong>–§—É–Ω–∫—Ü–∏—è ${state.round}(B, C, D)</strong>:</p>
    <p>B = ${hex32(B)}, C = ${hex32(C)}, D = ${hex32(D)}</p>
    <p>–†–µ–∑—É–ª—å—Ç–∞—Ç: <code>${hex32(state.Fval)}</code></p>

    <hr>

    <p><strong>–í—ã—á–∏—Å–ª–µ–Ω–∏–µ:</strong></p>
    <p><code>A + F + M[g] + K[i] = ${hex32(state.sum)}</code></p>
    <p>–ü–æ—Å–ª–µ —Å–¥–≤–∏–≥–∞ –≤–ª–µ–≤–æ –Ω–∞ ${state.s} –±–∏—Ç: <code>${hex32(state.rotated)}</code></p>
    <p>–ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ B: <code>B = B + —Å–¥–≤–∏–≥ = ${hex32(state.B)}</code></p>

    <hr>

    <p><strong>–ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤:</strong></p>
    <p>A ‚Üê D = ${hex32(state.A)}<br />
       D ‚Üê C = ${hex32(state.D)}<br />
       C ‚Üê B (—Å—Ç–∞—Ä–æ–µ) = ${hex32(state.C)}<br />
       B ‚Üê –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ = ${hex32(state.B)}</p>
  `;
}

  // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
  function nextStep() {
    if (currentStep >= 64) return;

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞–∑–∞–¥
    history.push({A, B, C, D});

    // –í—ã–ø–æ–ª–Ω—è–µ–º —à–∞–≥
    const res = md5Step(currentStep, A, B, C, D);
    A = res.A;
    B = res.B;
    C = res.C;
    D = res.D;

    updateRegisters();
    updateRegistersHighlight('B');
    renderIterationInfo(currentStep, res);
    currentStep++;

    updateProgress();

    prevBtn.disabled = false;
    if (currentStep === 64) {
      nextBtn.disabled = true;
      autoBtn.disabled = true;
      step7btn.style.opacity = 1;
      step7btn.style.pointerEvents = "auto";
      iterationDetailElem.innerHTML += `<p style="margin-top:20px; font-weight:bold; color:#2e7d32;">
      ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –∑–∞–≤–µ—Ä—à—ë–Ω!<br>
      –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±—É—Ñ–µ—Ä–∞ (CV1):<br>
      A = 0x${toHex((INIT_A + A) >>> 0)}<br>
      B = 0x${toHex((INIT_B + B) >>> 0)}<br>
      C = 0x${toHex((INIT_C + C) >>> 0)}<br>
      D = 0x${toHex((INIT_D + D) >>> 0)}<br>
      –ù–∞–∂–º–∏—Ç–µ "–®–∞–≥ 7" –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–ª–æ–∫–∞.
      </p>`;
    }
    if (currentStep === 1) prevBtn.disabled = false;
  }

  // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞–∑–∞–¥
  function prevStep() {
    if (currentStep <= 0) return;
    currentStep--;
    const prevState = history.pop();
    if (prevState) {
      A = prevState.A;
      B = prevState.B;
      C = prevState.C;
      D = prevState.D;
    }
    updateRegisters();
    updateRegistersHighlight(null);
    const initialState = md5Step(0, A, B, C, D);
    renderIterationInfo(0, initialState);

    iterationDetailElem.textContent = '–®–∞–≥ –Ω–∞–∑–∞–¥. –ò—Ç–µ—Ä–∞—Ü–∏—è: ' + (currentStep) + '. –ù–∞–∂–º–∏—Ç–µ "–í–ø–µ—Ä—ë–¥" —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.';
    updateProgress();
    nextBtn.disabled = false;
    autoBtn.disabled = false;
    if (currentStep === 0) prevBtn.disabled = true;
    step7btn.style.opacity = 0.5;
    step7btn.style.pointerEvents = "none";
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–±–∞—Ä
  function updateProgress() {
    progressFill.style.width = (currentStep / 64) * 100 + '%';
    progressFill.parentElement.setAttribute('aria-valuenow', currentStep);
  }

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å
  function autoPlay() {
    if (autoPlayId) {
      clearInterval(autoPlayId);
      autoPlayId = null;
      autoBtn.textContent = '‚ñ∂ –ê–≤—Ç–æ';
      nextBtn.disabled = false;
      prevBtn.disabled = currentStep === 0;
      return;
    }
    autoBtn.textContent = '‚è∏ –°—Ç–æ–ø';
    nextBtn.disabled = true;
    prevBtn.disabled = true;

    const speeds = { slow: 800, medium: 400, fast: 120, instant: 0 };
    const delay = speeds[speedSelect.value] ?? 400;

    if (delay === 0) {
      // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ - –¥–µ–ª–∞–µ–º –≤—Å–µ —à–∞–≥–∏ –ø–æ–¥—Ä—è–¥ –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ç–∞–π–º–∞—É—Ç–æ–º
      while (currentStep < 64) nextStep();
      autoPlay();
      return;
    }

    autoPlayId = setInterval(() => {
      if (currentStep >= 64) {
        autoPlay();
        return;
      }
      nextStep();
    }, delay);
  }

  // –°–±—Ä–æ—Å
  function reset() {
    if (autoPlayId) {
      clearInterval(autoPlayId);
      autoPlayId = null;
      autoBtn.textContent = '‚ñ∂ –ê–≤—Ç–æ';
    }
    currentStep = 0;
    history.length = 0;
    A = INIT_A; B = INIT_B; C = INIT_C; D = INIT_D;
    updateRegisters();
    updateRegistersHighlight(null);
    iterationDetailElem.textContent = '–ù–∞–∂–º–∏—Ç–µ "–í–ø–µ—Ä—ë–¥", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –±–ª–æ–∫–∞.';
    prevBtn.disabled = true;
    nextBtn.disabled = false;
    autoBtn.disabled = false;
    step7btn.style.opacity = 0.5;
    step7btn.style.pointerEvents = "none";
    updateProgress();
  }

  // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —à–∞–≥ 7 —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
  step7btn.onclick = () => {
    const CV1 = {
      A: (INIT_A + A) >>> 0,
      B: (INIT_B + B) >>> 0,
      C: (INIT_C + C) >>> 0,
      D: (INIT_D + D) >>> 0,
    };
    // –ü–µ—Ä–µ–¥–∞–µ–º CV1 –∫–∞–∫ —Ç–µ–∫—Å—Ç, data –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è - —Ç–æ–ª—å–∫–æ CV
    // –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ URL hex CV1 –¥–ª—è —à–∞–≥–∞ 7, –∞ —Ç–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.
    // –ù–æ —á—Ç–æ–±—ã –Ω–µ —É—Å–ª–æ–∂–Ω—è—Ç—å, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–¥–∏–º –∏—Å—Ö–æ–¥–Ω—ã–π text –∏ data
    window.location.href = `step7.html?text=${encodeURIComponent(text)}&data=${data}&cvA=${CV1.A}&cvB=${CV1.B}&cvC=${CV1.C}&cvD=${CV1.D}`;
  };

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
  nextBtn.onclick = nextStep;
  prevBtn.onclick = prevStep;
  autoBtn.onclick = autoPlay;
  resetBtn.onclick = reset;

  speedSelect.onchange = () => {
    if (autoPlayId) {
      autoPlay();
    }
  };

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  reset();

</script>
</body>
</html>
