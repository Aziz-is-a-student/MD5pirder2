<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–®–∞–≥ 3 ‚Äî –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–ª–∏–Ω—ã | MD5pider</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 80px 20px 20px;
      color: #333;
    }
    .btn {
      padding: 10px 16px;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      font-size: 14px;
      cursor: pointer;
      margin: 0 5px;
    }
    .btn:hover {
      background: #0d47a1;
    }
    .btn-reset {
      background: #d32f2f;
    }
    .btn-reset:hover {
      background: #b71c1c;
    }
    .nav-top {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      z-index: 1000;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .bit-square {
      display: inline-block;
      padding: 6px 8px;
      margin: 2px 1px;
      border-radius: 4px;
      font-family: monospace;
    }
    .bit-padding {
      background-color: #c8e6c9;
      border: 1px solid #81c784;
    }
    .bit-length {
      background-color: #bbdefb;
      border: 1px solid #64b5f6;
    }
    .bit-wrapper {
      text-align: center;
      margin-top: 20px;
      word-break: break-word;
      line-height: 2.2;
    }
    .section-title {
      text-align: center;
      font-weight: bold;
      margin-top: 30px;
      color: #555;
    }
    select {
      padding: 6px 10px;
      font-size: 14px;
      border-radius: 6px;
      margin-left: 10px;
    }
    code {
      background: #e0f7fa;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
    }
    .info-box {
      background: #e3f2fd;
      border-left: 6px solid #2196f3;
      padding: 16px;
      border-radius: 10px;
      margin: 20px 0;
    }
    .progress-bar {
      width: 100%;
      background: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
      margin: 20px 0;
      height: 20px;
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      background: #4caf50;
      transition: width 0.3s;
    }
    .progress-container {
      margin: 30px 0;
    }
    .progress-text {
      text-align: center;
      margin-top: 5px;
      font-size: 14px;
      color: #666;
    }
  </style>
</head>
<body>

<div class="nav-top">
  <a href="index.html" class="btn">üè† –ì–ª–∞–≤–Ω–∞—è</a>
  <a href="step2.html" class="btn">‚¨Ö –®–∞–≥ 2</a>
  <a id="step4Btn" class="btn">–®–∞–≥ 4 ‚û°</a>
</div>

<div class="container">
  <h2>üìè –®–∞–≥ 3 ‚Äî –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è</h2>

  <div class="info-box">
    <p>
      –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –≤–≤–µ–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ <strong>"<span id="textExample">crypto</span>"</strong>. –û–Ω–æ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 
      <strong><span id="charCount">6</span> —Å–∏–º–≤–æ–ª–æ–≤</strong>.
      –ö–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –≤ <strong>8 –±–∏—Ç</strong>, –ø–æ—ç—Ç–æ–º—É –æ–±—â–∞—è –¥–ª–∏–Ω–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç: 
      <strong><span id="bitCount">48</span> –±–∏—Ç</strong>.
    </p>

    <p>
      –ù–∞ —ç—Ç–æ–º —à–∞–≥–µ –º—ã –¥–æ–±–∞–≤–∏–º <strong>64 –±–∏—Ç–∞</strong>, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –¥–ª–∏–Ω—É –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è <em>–¥–æ padding-–∞</em>.
      –≠—Ç–∏ –±–∏—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–æ–Ω–µ—Ü padded-—Å–æ–æ–±—â–µ–Ω–∏—è.
    </p>

    <p>
      –î–ª–∏–Ω–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ <code>little-endian</code> —Ñ–æ—Ä–º–∞—Ç–µ ‚Äî —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ —Å–Ω–∞—á–∞–ª–∞ –∏–¥—É—Ç –º–ª–∞–¥—à–∏–µ –±–∞–π—Ç—ã.
    </p>

    <p>64-–±–∏—Ç–Ω–æ–µ –¥–≤–æ–∏—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è:</p>
    <div class="bit-wrapper" id="bitLengthBinary"></div>

    <p>–ê —Ç–∞–∫ –æ–Ω–æ –≤—ã–≥–ª—è–¥–∏—Ç –≤ little-endian –≤–∏–¥–µ (–±–∞–π—Ç—ã —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã):</p>
    <div class="bit-wrapper" id="bitLengthLittleEndian"></div>
  </div>

  <div class="section-title">üß© –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –±–ª–æ–∫–∞ (padded + –¥–ª–∏–Ω–∞)</div>

  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="progress-text" id="progressText">–ü—Ä–æ–≥—Ä–µ—Å—Å: 0/64 –±–∏—Ç (0%)</div>
  </div>

  <div class="bit-wrapper" id="bitDisplay"></div>

  <div class="bit-wrapper">
    <button class="btn" onclick="addNextBit()">–°–ª–µ–¥—É—é—â–∏–π –±–∏—Ç</button>
    <button class="btn" onclick="autoAdd()">–ê–≤—Ç–æ-–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</button>
    <button class="btn btn-reset" onclick="resetBits()">–°–±—Ä–æ—Å–∏—Ç—å</button>
    <label for="speed">–°–∫–æ—Ä–æ—Å—Ç—å:</label>
    <select id="speed">
      <option value="slow">–ú–µ–¥–ª–µ–Ω–Ω–æ</option>
      <option value="medium" selected>–°—Ä–µ–¥–Ω–µ</option>
      <option value="fast">–ë—ã—Å—Ç—Ä–æ</option>
      <option value="instant">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ</option>
    </select>
  </div>
</div>

<script>
  const params = new URLSearchParams(window.location.search);
  let inputText = params.get("text") || "crypto";
  let paddedBits = (params.get("data") || "").split('');

  document.getElementById("textExample").textContent = inputText;
  document.getElementById("charCount").textContent = inputText.length;

  if (!/^[01]{448}$/.test(paddedBits.join(''))) {
    const originalBits = inputText
      .split('')
      .map(c => c.charCodeAt(0).toString(2).padStart(8, '0'))
      .join('')
      .split('');
    let pad = ['1'];
    while ((originalBits.length + pad.length) % 512 !== 448) pad.push('0');
    paddedBits = [...originalBits, ...pad];
  }

  const bitDisplay = document.getElementById('bitDisplay');
  const bitCountSpan = document.getElementById('bitCount');
  const bitLengthBinaryDiv = document.getElementById('bitLengthBinary');
  const bitLengthLE = document.getElementById('bitLengthLittleEndian');
  const speedSelect = document.getElementById('speed');
  const progressFill = document.getElementById('progressFill');
  const progressText = document.getElementById('progressText');

  const originalLength = inputText.length * 8;
  bitCountSpan.textContent = originalLength;

  const lengthBinary = originalLength.toString(2).padStart(64, '0');
  const bytes = lengthBinary.match(/.{8}/g);
  const leBytes = [...bytes].reverse();
  const lengthLEBits = leBytes.join('').split('');

  renderBits(lengthBinary.split(''), bitLengthBinaryDiv, 'bit-length');
  renderBits(lengthLEBits, bitLengthLE, 'bit-length');

  let allBits = [...paddedBits];
  let index = 0;
  let autoAddInterval = null;

  function updateProgress() {
    const percent = (index / lengthLEBits.length) * 100;
    progressFill.style.width = percent + '%';
    progressText.textContent = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${index}/${lengthLEBits.length} –±–∏—Ç (${Math.round(percent)}%)`;
  }

  function resetBits() {
    index = 0;
    clearInterval(autoAddInterval);
    renderBits(allBits, bitDisplay, 'bit-padding');
    updateProgress();
  }

  function addNextBit() {
    if (index >= lengthLEBits.length) return;
    const span = document.createElement('span');
    span.className = 'bit-square bit-length';
    span.textContent = lengthLEBits[index];
    bitDisplay.appendChild(span);
    index++;
    if ((allBits.length + index) % 8 === 0) bitDisplay.appendChild(document.createTextNode(" "));
    updateProgress();
  }

  function autoAdd() {
    const speed = speedSelect.value;
    clearInterval(autoAddInterval);
    
    if (speed === 'instant') {
      while (index < lengthLEBits.length) addNextBit();
    } else {
      const delays = {
        slow: 300,
        medium: 100,
        fast: 30
      };
      autoAddInterval = setInterval(() => {
        if (index >= lengthLEBits.length) {
          clearInterval(autoAddInterval);
          return;
        }
        addNextBit();
      }, delays[speed]);
    }
  }

  function renderBits(bits, container, cls) {
    container.innerHTML = '';
    bits.forEach((b, i) => {
      const span = document.createElement('span');
      span.textContent = b;
      span.className = 'bit-square ' + cls;
      container.appendChild(span);
      if ((i + 1) % 8 === 0) container.appendChild(document.createTextNode(" "));
    });
  }

  // Initial render
  renderBits(allBits, bitDisplay, 'bit-padding');
  updateProgress();
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —à–∞–≥ 4 —Å —É—á—ë—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö
document.getElementById("step4Btn").href =
`step4.html?text=${encodeURIComponent(inputText)}&data=${[...allBits, ...lengthLEBits].join('')}`;

</script>

</body>
</html>