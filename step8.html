<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–®–∞–≥ 8 ‚Äî –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–ª–æ–∫–∞ Yq | MD5pider</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f8;
      color: #333;
      margin: 0;
      padding: 80px 20px 20px;
      user-select: none;
    }
    .nav-top {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
    }
    .btn {
      padding: 10px 16px;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      text-decoration: none;
      user-select: none;
      min-width: 90px;
      margin-left: 8px;
    }
    .btn:hover:not(:disabled) {
      background: #0d47a1;
    }
    .btn:disabled {
      background: #90a4ae;
      cursor: default;
    }
    .btn-final {
      background: #4caf50;
    }
    .btn-final:hover {
      background: #388e3c;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background: white;
      border-radius: 12px;
      padding: 30px 40px 40px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      user-select: text;
    }
    h2 {
      color: #424242;
      margin-top: 0;
      text-align: center;
    }
    .info-yellow {
      max-width: 850px;
      margin: 20px auto 10px;
      background: #fff9c4;
      border-left: 6px solid #fbc02d;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      color: #5d4037;
      box-shadow: 0 2px 8px rgb(251 192 45 / 0.3);
      user-select: text;
      line-height: 1.4;
    }
    .info-blue {
      max-width: 850px;
      margin: 0 auto 30px;
      background: #e3f2fd;
      border-left: 6px solid #42a5f5;
      padding: 15px 20px;
      border-radius: 8px;
      font-size: 15px;
      color: #0d47a1;
      line-height: 1.5;
      box-shadow: 0 3px 10px rgb(66 165 245 / 0.25);
      user-select: text;
    }
    .registers {
      display: flex;
      justify-content: center;
      gap: 25px;
      margin: 20px 0 35px;
      font-family: monospace;
      font-size: 18px;
      user-select: text;
    }
    .reg-box {
      background: #e3f2fd;
      border: 2px solid #64b5f6;
      padding: 12px 18px;
      border-radius: 8px;
      min-width: 130px;
      text-align: center;
      box-shadow: 0 3px 8px rgba(33,150,243,0.25);
      transition: background-color 0.3s ease;
      position: relative;
    }
    .reg-label {
      font-weight: 700;
      margin-bottom: 8px;
      color: #0d47a1;
      font-size: 20px;
    }
    .reg-value {
      font-family: 'Courier New', Courier, monospace;
      font-size: 20px;
      user-select: text;
      letter-spacing: 1.3px;
    }
    .iteration-info {
      text-align: center;
      margin-bottom: 30px;
      font-size: 18px;
      font-weight: 600;
      color: #424242;
    }
    .iteration-detail {
      max-width: 850px;
      margin: 0 auto 40px;
      background: #e1f5fe;
      border-radius: 10px;
      padding: 18px 30px;
      box-shadow: 0 4px 10px rgba(0, 150, 255, 0.15);
      font-family: monospace;
      font-size: 17px;
      color: #01579b;
      line-height: 1.5;
      user-select: text;
    }
    .iteration-detail span {
      font-weight: 700;
      color: #0277bd;
    }
    .controls {
      text-align: center;
      margin-bottom: 25px;
      user-select: none;
    }
    .speed-select {
      margin-left: 15px;
      font-size: 15px;
      padding: 5px 12px;
      border-radius: 5px;
      border: 1px solid #aaa;
      cursor: pointer;
      user-select: none;
    }
    .progress-bar {
      background: #e0e0e0;
      height: 16px;
      width: 100%;
      border-radius: 10px;
      overflow: hidden;
      max-width: 850px;
      margin: 0 auto 40px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.12);
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      background: #42a5f5;
      transition: width 0.3s ease;
    }
    .footer-note {
      max-width: 850px;
      margin: 0 auto;
      font-size: 14px;
      color: #555;
      text-align: center;
      user-select: none;
    }
    .buffer-update {
      max-width: 850px;
      margin: 20px auto;
      padding: 15px;
      background: #fff3e0;
      border-left: 6px solid #ffa000;
      border-radius: 8px;
      font-family: monospace;
      font-size: 16px;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in {
      animation: fadeIn 0.5s ease forwards;
    }
  </style>
</head>
<body>

<div class="nav-top">
  <a id="step7link" class="btn" href="#">‚¨Ö –®–∞–≥ 7</a>
  <a href="index.html" class="btn">üè† –ì–ª–∞–≤–Ω–∞—è</a>
  <button id="step9btn" class="btn btn-final" disabled style="opacity:0.5; pointer-events:none;">–®–∞–≥ 9 ‚û°</button>
</div>

<div class="container">
  <h2>üõ† –®–∞–≥ 8 ‚Äî –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–ª–æ–∫–∞ Yq</h2>

  <div class="info-yellow">
    –ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: '<span id="originalText">crypto</span>'<br />
    –î–ª–∏–Ω–∞ –±–ª–æ–∫–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 512 –±–∏—Ç<br />
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–π –±–ª–æ–∫: Y<sub>q</sub> (–ø–æ—Å–ª–µ–¥–Ω–∏–π)
  </div>

  <div class="info-blue">
    <strong>–¢–µ–æ—Ä–∏—è: —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —ç—Ç–æ–º —à–∞–≥–µ?</strong><br />
    –≠—Ç–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —ç—Ç–∞–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–ª–æ–∫–æ–≤. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è 64 –∏—Ç–µ—Ä–∞—Ü–∏–π –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–ª–æ–∫–∞ Y<sub>q</sub>,<br />
    –º—ã –ø–æ–ª—É—á–∏–º –∏—Ç–æ–≥–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±—É—Ñ–µ—Ä–∞ (CV<sub>q</sub>), –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ 128-–±–∏—Ç–Ω—ã–π —Ö–µ—à –Ω–∞ —à–∞–≥–µ 9.
  </div>

  <div class="registers" aria-label="–ó–Ω–∞—á–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ MD5">
    <div class="reg-box" id="regA"><div class="reg-label">A</div><div class="reg-value">0x67452301</div></div>
    <div class="reg-box" id="regB"><div class="reg-label">B</div><div class="reg-value">0xefcdab89</div></div>
    <div class="reg-box" id="regC"><div class="reg-label">C</div><div class="reg-value">0x98badcfe</div></div>
    <div class="reg-box" id="regD"><div class="reg-label">D</div><div class="reg-value">0x10325476</div></div>
  </div>

  <div class="iteration-info" id="iterationInfo">
    –ò—Ç–µ—Ä–∞—Ü–∏—è: <span id="iterNumber">0</span> / 64
    &nbsp;&nbsp;|&nbsp;&nbsp;
    –†–∞—É–Ω–¥: <span id="roundName">-</span>
  </div>

  <div class="iteration-detail" id="iterationDetail" aria-live="polite" aria-atomic="true">
    –ù–∞–∂–º–∏—Ç–µ "–í–ø–µ—Ä—ë–¥", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–ª–æ–∫–∞.
  </div>

  <div id="bufferUpdateContainer" style="display: none;">
    <div class="buffer-update fade-in">
      <div>üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–ª–æ–∫–∞:</div>
      <div id="bufferUpdateText"></div>
    </div>
  </div>

  <div class="controls" role="region" aria-label="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–≥–∞–º–∏ –∞–Ω–∏–º–∞—Ü–∏–∏">
    <button class="btn" id="prevBtn" disabled>‚¨Ö –ù–∞–∑–∞–¥</button>
    <button class="btn" id="nextBtn">–í–ø–µ—Ä—ë–¥ ‚û°</button>
    <button class="btn" id="autoBtn">‚ñ∂ –ê–≤—Ç–æ</button>
    <button class="btn" id="resetBtn" style="background:#d32f2f;">‚ü≤ –°–±—Ä–æ—Å</button>

    <label for="speedSelect" style="margin-left: 15px; font-weight: 600; color:#1976d2;">–°–∫–æ—Ä–æ—Å—Ç—å:</label>
    <select id="speedSelect" class="speed-select" aria-label="–í—ã–±–æ—Ä —Å–∫–æ—Ä–æ—Å—Ç–∏ –∞–Ω–∏–º–∞—Ü–∏–∏">
      <option value="slow">–ú–µ–¥–ª–µ–Ω–Ω–æ</option>
      <option value="medium" selected>–°—Ä–µ–¥–Ω–µ</option>
      <option value="fast">–ë—ã—Å—Ç—Ä–æ</option>
      <option value="instant">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ</option>
    </select>
  </div>

  <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="64" aria-valuenow="0" aria-label="–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–ª–æ–∫–∞">
    <div class="progress-fill" id="progressFill"></div>
  </div>

  <div class="footer-note">
    –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–º–∏—Ç–µ "–®–∞–≥ 9" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ 128-–±–∏—Ç–Ω–æ–≥–æ —Ö–µ—à–∞.
  </div>
</div>

<script>
  // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
  const params = new URLSearchParams(window.location.search);
  const text = params.get("text") || "crypto";
  const data = params.get("data") || "01100011011100100111100101110000011101000110111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000";

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–≥–∏—Å—Ç—Ä—ã –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
  const INIT_A = parseInt(params.get("cvA")) || 0x67452301;
  const INIT_B = parseInt(params.get("cvB")) || 0xefcdab89;
  const INIT_C = parseInt(params.get("cvC")) || 0x98badcfe;
  const INIT_D = parseInt(params.get("cvD")) || 0x10325476;

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  document.getElementById('originalText').textContent = text;

  // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞ MD5
  const K = [
    0xd76aa478, 0xe8c7b756, 0x242070db, 0xc1bdceee,
    0xf57c0faf, 0x4787c62a, 0xa8304613, 0xfd469501,
    0x698098d8, 0x8b44f7af, 0xffff5bb1, 0x895cd7be,
    0x6b901122, 0xfd987193, 0xa679438e, 0x49b40821,
    0xf61e2562, 0xc040b340, 0x265e5a51, 0xe9b6c7aa,
    0xd62f105d, 0x02441453, 0xd8a1e681, 0xe7d3fbc8,
    0x21e1cde6, 0xc33707d6, 0xf4d50d87, 0x455a14ed,
    0xa9e3e905, 0xfcefa3f8, 0x676f02d9, 0x8d2a4c8a,
    0xfffa3942, 0x8771f681, 0x6d9d6122, 0xfde5380c,
    0xa4beea44, 0x4bdecfa9, 0xf6bb4b60, 0xbebfbc70,
    0x289b7ec6, 0xeaa127fa, 0xd4ef3085, 0x04881d05,
    0xd9d4d039, 0xe6db99e5, 0x1fa27cf8, 0xc4ac5665,
    0xf4292244, 0x432aff97, 0xab9423a7, 0xfc93a039,
    0x655b59c3, 0x8f0ccc92, 0xffeff47d, 0x85845dd1,
    0x6fa87e4f, 0xfe2ce6e0, 0xa3014314, 0x4e0811a1,
    0xf7537e82, 0xbd3af235, 0x2ad7d2bb, 0xeb86d391
  ];

  const S = [
    7, 12, 17, 22, 7, 12, 17, 22, 7, 12, 17, 22, 7, 12, 17, 22,
    5, 9, 14, 20, 5, 9, 14, 20, 5, 9, 14, 20, 5, 9, 14, 20,
    4, 11, 16, 23, 4, 11, 16, 23, 4, 11, 16, 23, 4, 11, 16, 23,
    6, 10, 15, 21, 6, 10, 15, 21, 6, 10, 15, 21, 6, 10, 15, 21
  ];

  // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –±–ª–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏—è
  const M = [];
  for (let i = 0; i < 512; i += 32) {
    const wordBits = data.slice(i, i + 32);
    const bytes = [
      wordBits.slice(0, 8),
      wordBits.slice(8, 16),
      wordBits.slice(16, 24),
      wordBits.slice(24, 32)
    ];
    const littleEndianWord = bytes.reverse().join('');
    M.push(parseInt(littleEndianWord, 2));
  }

  // –¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤
  let A = INIT_A, B = INIT_B, C = INIT_C, D = INIT_D;

  // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
  const regValuesElems = {
    A: document.querySelector('#regA .reg-value'),
    B: document.querySelector('#regB .reg-value'),
    C: document.querySelector('#regC .reg-value'),
    D: document.querySelector('#regD .reg-value')
  };
  const iterNumberElem = document.getElementById('iterNumber');
  const roundNameElem = document.getElementById('roundName');
  const iterationDetailElem = document.getElementById('iterationDetail');
  const progressFill = document.getElementById('progressFill');
  const step9btn = document.getElementById('step9btn');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const autoBtn = document.getElementById('autoBtn');
  const resetBtn = document.getElementById('resetBtn');
  const speedSelect = document.getElementById('speedSelect');
  const bufferUpdateContainer = document.getElementById('bufferUpdateContainer');
  const bufferUpdateText = document.getElementById('bufferUpdateText');

  let currentStep = 0;
  let autoPlayId = null;
  const history = [];

  // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
  function toHex(num) {
    return (num >>> 0).toString(16).padStart(8, '0');
  }

  function toLittleEndianHex(value) {
    return ('00000000' + value.toString(16)).slice(-8).match(/../g).reverse().join('');
  }

  function getRound(i) {
    if (i < 16) return 'F';
    if (i < 32) return 'G';
    if (i < 48) return 'H';
    return 'I';
  }

  function gIndex(i) {
    if (i < 16) return i;
    if (i < 32) return (5 * i + 1) % 16;
    if (i < 48) return (3 * i + 5) % 16;
    return (7 * i) % 16;
  }

  // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ MD5
  function F(x, y, z) { return (x & y) | (~x & z); }
  function G(x, y, z) { return (x & z) | (y & ~z); }
  function H(x, y, z) { return x ^ y ^ z; }
  function I(x, y, z) { return y ^ (x | ~z); }

  function Ffunc(round, b, c, d) {
    switch (round) {
      case 'F': return F(b, c, d);
      case 'G': return G(b, c, d);
      case 'H': return H(b, c, d);
      case 'I': return I(b, c, d);
    }
  }

  function leftRotate(x, c) {
    return (x << c) | (x >>> (32 - c));
  }

  function md5Step(i, AA, BB, CC, DD) {
    const round = getRound(i);
    const g = gIndex(i);
    const Fval = Ffunc(round, BB, CC, DD);
    const s = S[i];
    const Kval = K[i];
    const Mval = M[g];
    const sum = (AA + Fval + Mval + Kval) >>> 0;
    const rotated = leftRotate(sum, s) >>> 0;
    return {
      round, g, Fval, Kval, Mval, s, sum, rotated
    };
  }

  // –§—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  function updateRegisters() {
    regValuesElems.A.textContent = "0x" + toHex(A);
    regValuesElems.B.textContent = "0x" + toHex(B);
    regValuesElems.C.textContent = "0x" + toHex(C);
    regValuesElems.D.textContent = "0x" + toHex(D);
  }

  function updateUI(stepData) {
    iterNumberElem.textContent = currentStep;
    roundNameElem.textContent = stepData.round;

    const hex32 = num => "0x" + toHex(num);
    const bitStart = stepData.g * 32;
    const rawBits = data.slice(bitStart, bitStart + 32);
    const leBytes = rawBits.match(/.{8}/g).reverse().join(' '); // little-endian –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ

    iterationDetailElem.innerHTML = `
        <p>–†–∞—É–Ω–¥: <strong style="color:#0d47a1;">${stepData.round}</strong> &nbsp;&nbsp;
           g = <strong>${stepData.g}</strong> &nbsp;&nbsp;
           s = <strong>${stepData.s}</strong> –±–∏—Ç</p>

        <hr>

        <p><strong>–°–ª–æ–≤–æ M[${stepData.g}]</strong> –∏–∑ –±–ª–æ–∫–∞ Y<sub>q</sub>:</p>
        <p>–ò—Å—Ö–æ–¥–Ω—ã–µ –±–∏—Ç—ã: <code>${rawBits}</code><br />
           –†–∞–∑–≤—ë—Ä–Ω—É—Ç–æ (little-endian): <code>${leBytes}</code><br />
           –ó–Ω–∞—á–µ–Ω–∏–µ: <code>${hex32(stepData.Mval)}</code></p>

        <p><strong>–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ K[${currentStep-1}]</strong>: <code>${hex32(stepData.Kval)}</code><br />
           –§–æ—Ä–º—É–ª–∞: <code>K[${currentStep-1}] = floor(2^32 √ó |sin(${currentStep})|)</code></p>

        <hr>

        <p><strong>–§—É–Ω–∫—Ü–∏—è ${stepData.round}(B, C, D)</strong>:</p>
        <p>B = ${hex32(B)}, C = ${hex32(C)}, D = ${hex32(D)}</p>
        <p>–†–µ–∑—É–ª—å—Ç–∞—Ç: <code>${hex32(stepData.Fval)}</code></p>

        <hr>

        <p><strong>–í—ã—á–∏—Å–ª–µ–Ω–∏–µ:</strong></p>
        <p><code>A + F + M[g] + K[i] = ${hex32(stepData.sum)}</code></p>
        <p>–ü–æ—Å–ª–µ —Å–¥–≤–∏–≥–∞ –≤–ª–µ–≤–æ –Ω–∞ ${stepData.s} –±–∏—Ç: <code>${hex32(stepData.rotated)}</code></p>
        <p>–ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ B: <code>B = B + —Å–¥–≤–∏–≥ = ${hex32(B)}</code></p>

        <hr>

        <p><strong>–ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤:</strong></p>
        <p>A ‚Üê D = ${hex32(A)}<br />
           D ‚Üê C = ${hex32(D)}<br />
           C ‚Üê B (—Å—Ç–∞—Ä–æ–µ) = ${hex32(C)}<br />
           B ‚Üê –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ = ${hex32(B)}</p>
    `;

    progressFill.style.width = `${(currentStep / 64) * 100}%`;

    if (currentStep === 64) {
        nextBtn.disabled = true;
        autoBtn.disabled = true;
        step9btn.disabled = false;
        step9btn.style.opacity = "1";
        step9btn.style.pointerEvents = "auto";
        showBufferUpdate();
    }
  }

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–≥–∞–º–∏
  function nextStep() {
    if (currentStep >= 64) return;

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ —à–∞–≥–æ–º
    history.push({A, B, C, D});

    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
    const stepData = md5Step(currentStep, A, B, C, D);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤
    const AA = A, BB = B, CC = C, DD = D;
    
    // –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ MD5:
    A = D;
    B = (BB + leftRotate((AA + stepData.Fval + stepData.Mval + stepData.Kval) >>> 0, stepData.s)) >>> 0;
    C = BB;
    D = CC;

    currentStep++;

    updateRegisters();
    updateUI(stepData);
    prevBtn.disabled = false;

    if (currentStep === 64) {
      showBufferUpdate();
    }
  }

  function prevStep() {
    if (currentStep <= 0) return;

    currentStep--;
    const prevState = history.pop();

    A = prevState.A;
    B = prevState.B;
    C = prevState.C;
    D = prevState.D;

    updateRegisters();

    if (currentStep > 0) {
      const stepData = md5Step(currentStep-1, A, B, C, D);
      updateUI(stepData);
    } else {
      iterationDetailElem.textContent = "–ù–∞–∂–º–∏—Ç–µ '–í–ø–µ—Ä—ë–¥', —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–ª–æ–∫–∞.";
      iterNumberElem.textContent = "0";
      roundNameElem.textContent = "-";
    }

    progressFill.style.width = `${(currentStep / 64) * 100}%`;

    nextBtn.disabled = false;
    autoBtn.disabled = false;
    step9btn.disabled = true;
    step9btn.style.opacity = "0.5";
    step9btn.style.pointerEvents = "none";
  }

  function autoPlay() {
    if (autoPlayId) {
      clearInterval(autoPlayId);
      autoPlayId = null;
      autoBtn.textContent = "‚ñ∂ –ê–≤—Ç–æ";
      return;
    }

    autoBtn.textContent = "‚ùö‚ùö –ü–∞—É–∑–∞";
    const speed = speedSelect.value;
    const delay = {
      slow: 1000,
      medium: 500,
      fast: 200,
      instant: 0
    }[speed];

    autoPlayId = setInterval(() => {
      if (currentStep >= 64) {
        clearInterval(autoPlayId);
        autoPlayId = null;
        autoBtn.textContent = "‚ñ∂ –ê–≤—Ç–æ";
        return;
      }
      nextStep();
    }, delay);
  }

  function reset() {
    if (autoPlayId) {
      clearInterval(autoPlayId);
      autoPlayId = null;
      autoBtn.textContent = "‚ñ∂ –ê–≤—Ç–æ";
    }

    currentStep = 0;
    A = INIT_A;
    B = INIT_B;
    C = INIT_C;
    D = INIT_D;
    history.length = 0;

    updateRegisters();
    iterNumberElem.textContent = "0";
    roundNameElem.textContent = "-";
    iterationDetailElem.textContent = "–ù–∞–∂–º–∏—Ç–µ '–í–ø–µ—Ä—ë–¥', —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–ª–æ–∫–∞.";
    progressFill.style.width = "0%";
    prevBtn.disabled = true;
    nextBtn.disabled = false;
    autoBtn.disabled = false;
    step9btn.disabled = true;
    step9btn.style.opacity = "0.5";
    step9btn.style.pointerEvents = "none";
  }

  // –ù–∞–≤–∏–≥–∞—Ü–∏—è
  document.getElementById('step7link').href = `step7.html?text=${encodeURIComponent(text)}&data=${encodeURIComponent(data)}`;
  step9btn.onclick = () => {
    window.location.href = `step9.html?text=${encodeURIComponent(text)}`;
  };

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
  nextBtn.addEventListener('click', nextStep);
  prevBtn.addEventListener('click', prevStep);
  autoBtn.addEventListener('click', autoPlay);
  resetBtn.addEventListener('click', reset);

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  prevBtn.disabled = true;
  updateRegisters();
</script>
</body>
</html>